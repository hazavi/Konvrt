---

---

<div id="view-download" style="display:none;">
  <div class="dl-container">
    <!-- Setup banner (shows when yt-dlp not installed) -->
    <div id="dl-setup" class="dl-setup" style="display:none;">
      <div class="dl-setup-icon">
        <svg
          width="40"
          height="40"
          viewBox="0 0 24 24"
          fill="none"
          stroke="var(--accent)"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          ><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline
            points="7 10 12 15 17 10"></polyline><line
            x1="12"
            y1="15"
            x2="12"
            y2="3"></line></svg
        >
      </div>
      <h3 class="dl-setup-title">Download Engine Required</h3>
      <p class="dl-setup-desc">
        yt-dlp is needed to enable video downloading from YouTube and other
        platforms.
      </p>
      <button id="dl-install-btn" class="dl-install-btn">
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          ><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline
            points="7 10 12 15 17 10"></polyline><line
            x1="12"
            y1="15"
            x2="12"
            y2="3"></line></svg
        >
        Install yt-dlp
      </button>
      <p id="dl-install-status" class="dl-setup-status"></p>
    </div>

    <!-- Main download UI -->
    <div id="dl-main" style="display:none;">
      <!-- URL input section -->
      <div class="dl-input-section">
        <div class="dl-platform-tabs" id="dl-platform-tabs">
          <button class="dl-platform-tab active" data-platform="youtube">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
              ><path
                d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"
              ></path></svg
            >
            YouTube
          </button>
          <button class="dl-platform-tab" data-platform="tiktok">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"
              ><path
                d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1-2.89-2.89 2.89 2.89 0 0 1 2.89-2.89c.28 0 .54.04.79.1v-3.5a6.37 6.37 0 0 0-.79-.05A6.34 6.34 0 0 0 3.15 15a6.34 6.34 0 0 0 6.34 6.34 6.34 6.34 0 0 0 6.34-6.34V8.87a8.16 8.16 0 0 0 4.77 1.52V6.94a4.85 4.85 0 0 1-1.01-.25z"
              ></path></svg
            >
            TikTok
          </button>
        </div>
        <div class="dl-url-row">
          <input
            id="dl-url-input"
            type="text"
            class="dl-url-input"
            placeholder="Paste YouTube or TikTok URL here..."
            autocomplete="off"
            spellcheck="false"
          />
          <button
            id="dl-fetch-btn"
            class="dl-fetch-btn"
            title="Fetch video info"
          >
            <svg
              class="dl-fetch-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              ><polyline points="7 10 12 15 17 10"></polyline><line
                x1="12"
                y1="15"
                x2="12"
                y2="3"></line><path
                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path></svg
            >
            <span class="dl-fetch-spinner" style="display:none;"></span>
          </button>
        </div>
      </div>

      <!-- Video info card (shown after fetch) -->
      <div id="dl-info-card" class="dl-info-card" style="display:none;">
        <div class="dl-thumb-wrap">
          <img id="dl-thumb" class="dl-thumb" src="" alt="" />
          <span id="dl-duration" class="dl-duration">0:00</span>
        </div>
        <div class="dl-info-details">
          <h3 id="dl-title" class="dl-info-title">Video Title</h3>
          <span id="dl-uploader" class="dl-info-uploader">Uploader</span>
          <span id="dl-platform-badge" class="dl-platform-badge">YouTube</span>
        </div>
      </div>

      <!-- Download options -->
      <div id="dl-options" class="dl-options" style="display:none;">
        <div class="dl-format-section">
          <label class="dl-label">Format</label>
          <div class="dl-format-btns" id="dl-format-btns">
            <button class="dl-fmt-btn active" data-dl-format="mp4">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><polygon points="23 7 16 12 23 17 23 7"></polygon><rect
                  x="1"
                  y="5"
                  width="15"
                  height="14"
                  rx="2"
                  ry="2"></rect></svg
              >
              MP4
            </button>
            <button class="dl-fmt-btn" data-dl-format="webm">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><polygon points="23 7 16 12 23 17 23 7"></polygon><rect
                  x="1"
                  y="5"
                  width="15"
                  height="14"
                  rx="2"
                  ry="2"></rect></svg
              >
              WEBM
            </button>
            <button class="dl-fmt-btn" data-dl-format="mp3">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"
                ></circle><circle cx="18" cy="16" r="3"></circle></svg
              >
              MP3
            </button>
            <button class="dl-fmt-btn" data-dl-format="m4a">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"
                ></circle><circle cx="18" cy="16" r="3"></circle></svg
              >
              M4A
            </button>
            <button class="dl-fmt-btn" data-dl-format="wav">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"
                ></circle><circle cx="18" cy="16" r="3"></circle></svg
              >
              WAV
            </button>
          </div>
        </div>
        <div class="dl-quality-section">
          <label class="dl-label">Quality</label>
          <div class="dl-quality-btns" id="dl-quality-btns">
            <button class="dl-qual-btn active" data-dl-quality="best"
              >Best</button
            >
            <button class="dl-qual-btn" data-dl-quality="1080">1080p</button>
            <button class="dl-qual-btn" data-dl-quality="720">720p</button>
            <button class="dl-qual-btn" data-dl-quality="480">480p</button>
          </div>
        </div>
        <div class="dl-output-section">
          <button
            id="dl-output-btn"
            class="dl-output-chip"
            title="Select output folder"
          >
            <svg
              width="13"
              height="13"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              ><path
                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
              ></path></svg
            >
            <span id="dl-output-label">Choose folder...</span>
          </button>
          <div class="dl-proxy-row">
            <button
              id="dl-proxy-toggle"
              class="dl-proxy-toggle"
              title="Proxy settings"
            >
              <svg
                width="13"
                height="13"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><circle cx="12" cy="12" r="10"></circle><line
                  x1="2"
                  y1="12"
                  x2="22"
                  y2="12"></line><path
                  d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
                ></path></svg
              >
            </button>
            <div
              id="dl-proxy-panel"
              class="dl-proxy-panel"
              style="display:none;"
            >
              <input
                id="dl-proxy-input"
                class="dl-proxy-input"
                type="text"
                placeholder="socks5://127.0.0.1:1080"
                spellcheck="false"
              />
              <button id="dl-proxy-save" class="dl-proxy-save">Save</button>
            </div>
          </div>
        </div>
        <button id="dl-start-btn" class="dl-start-btn" disabled>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
            ></path><polyline points="7 10 12 15 17 10"></polyline><line
              x1="12"
              y1="15"
              x2="12"
              y2="3"></line></svg
          >
          Download
        </button>
      </div>

      <!-- Download progress -->
      <div id="dl-progress" class="dl-progress" style="display:none;">
        <div class="dl-progress-header">
          <span id="dl-progress-label" class="dl-progress-label"
            >Downloading...</span
          >
          <span id="dl-progress-pct" class="dl-progress-pct">0%</span>
        </div>
        <div class="dl-progress-bar-wrap">
          <div id="dl-progress-fill" class="dl-progress-fill" style="width:0%">
          </div>
        </div>
        <div class="dl-progress-meta">
          <span id="dl-progress-speed"></span>
          <span id="dl-progress-eta"></span>
        </div>
      </div>

      <!-- Download actions row -->
      <div id="dl-actions-row" class="dl-actions-row" style="display:none;">
        <button id="dl-clear-btn" class="dl-clear-btn" title="Clear and start fresh">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
          New Download
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  /* ── Download view ────────────────────────────── */
  #view-download {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    min-height: 0;
  }
  .dl-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-width: 680px;
    width: 100%;
    margin: 0 auto;
  }
  .dl-setup {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 48px 24px;
    text-align: center;
    flex: 1;
  }
  .dl-setup-icon {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: rgba(124, 92, 252, 0.08);
    border: 1.5px solid rgba(124, 92, 252, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 4px;
  }
  .dl-setup-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
  }
  .dl-setup-desc {
    font-size: 12px;
    color: var(--text-dim);
    max-width: 380px;
    line-height: 1.5;
    margin: 0;
  }
  .dl-setup-status {
    font-size: 11px;
    color: var(--accent);
    margin: 0;
    min-height: 16px;
  }
  .dl-install-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 24px;
    border: none;
    border-radius: var(--radius-sm);
    background: var(--accent);
    color: #fff;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
    font-family: inherit;
  }
  .dl-install-btn:hover:not(:disabled) {
    box-shadow: 0 4px 20px var(--accent-glow);
    transform: translateY(-1px);
  }
  .dl-install-btn:disabled {
    opacity: 0.5;
    pointer-events: none;
  }
  /* Input section */
  .dl-input-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .dl-platform-tabs {
    display: flex;
    gap: 1px;
    padding: 2px;
    background: var(--surface-2);
    border-radius: var(--radius-sm);
    width: fit-content;
  }
  .dl-platform-tab {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 16px;
    border: none;
    border-radius: 5px;
    background: transparent;
    color: var(--text-dim);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition);
  }
  .dl-platform-tab:hover {
    color: var(--text-secondary);
  }
  .dl-platform-tab.active {
    color: #fff;
    background: var(--accent);
    box-shadow: 0 1px 6px var(--accent-glow);
  }
  .dl-platform-tab svg {
    width: 14px;
    height: 14px;
  }
  .dl-url-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .dl-url-input {
    flex: 1;
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    color: var(--text-primary);
    font-size: 13px;
    font-family: inherit;
    outline: none;
    transition:
      border-color var(--transition),
      box-shadow var(--transition);
  }
  .dl-url-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .dl-url-input::placeholder {
    color: var(--text-dim);
    opacity: 0.5;
  }
  .dl-fetch-btn {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-sm);
    background: var(--accent);
    border: none;
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--transition);
  }
  .dl-fetch-btn:hover {
    box-shadow: 0 2px 12px var(--accent-glow);
    transform: translateY(-1px);
  }
  .dl-fetch-btn:disabled {
    opacity: 0.7;
    pointer-events: none;
    transform: none;
    box-shadow: none;
  }
  .dl-fetch-btn.loading .dl-fetch-icon {
    display: none;
  }
  .dl-fetch-btn.loading .dl-fetch-spinner {
    display: block !important;
  }
  .dl-fetch-spinner {
    width: 18px;
    height: 18px;
    border: 2.5px solid rgba(255, 255, 255, 0.25);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }
  /* Info card */
  .dl-info-card {
    display: flex;
    gap: 14px;
    padding: 12px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    animation: fadeIn 0.2s ease-out;
  }
  .dl-thumb-wrap {
    position: relative;
    width: 160px;
    height: 90px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
    background: var(--surface-2);
  }
  .dl-thumb {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .dl-duration {
    position: absolute;
    bottom: 4px;
    right: 4px;
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    letter-spacing: 0.3px;
  }
  .dl-info-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
    justify-content: center;
  }
  .dl-info-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .dl-info-uploader {
    font-size: 11px;
    color: var(--text-dim);
  }
  .dl-platform-badge {
    font-size: 9px;
    font-weight: 700;
    color: var(--accent);
    background: rgba(124, 92, 252, 0.1);
    border: 1px solid rgba(124, 92, 252, 0.2);
    padding: 2px 8px;
    border-radius: 8px;
    width: fit-content;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  /* Options */
  .dl-options {
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 14px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    animation: fadeIn 0.2s ease-out;
  }
  .dl-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 6px;
    display: block;
  }
  .dl-format-section,
  .dl-quality-section {
    display: flex;
    flex-direction: column;
  }
  .dl-format-btns,
  .dl-quality-btns {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  .dl-fmt-btn,
  .dl-qual-btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 7px 14px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    color: var(--text-dim);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
  }
  .dl-fmt-btn:hover,
  .dl-qual-btn:hover {
    border-color: var(--border-hover);
    color: var(--text-secondary);
  }
  .dl-fmt-btn.active,
  .dl-qual-btn.active {
    border-color: var(--accent);
    background: rgba(124, 92, 252, 0.1);
    color: #fff;
    box-shadow: 0 0 8px var(--accent-glow);
  }
  .dl-fmt-btn svg {
    opacity: 0.5;
  }
  .dl-fmt-btn.active svg {
    opacity: 1;
  }
  .dl-output-section {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .dl-output-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-dim);
    font-size: 11px;
    cursor: pointer;
    transition: all var(--transition);
    font-family: inherit;
    max-width: 260px;
  }
  .dl-output-chip span {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .dl-output-chip:hover {
    border-color: var(--border-hover);
    color: var(--text-secondary);
  }
  .dl-proxy-row {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .dl-proxy-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-dim);
    cursor: pointer;
    transition: all var(--transition);
    flex-shrink: 0;
  }
  .dl-proxy-toggle:hover,
  .dl-proxy-toggle.active {
    border-color: var(--accent);
    color: var(--accent);
  }
  .dl-proxy-panel {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .dl-proxy-input {
    width: 200px;
    padding: 5px 8px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    font-size: 11px;
    font-family: "SF Mono", "Fira Code", monospace;
    outline: none;
    transition: border-color var(--transition);
  }
  .dl-proxy-input:focus {
    border-color: var(--accent);
  }
  .dl-proxy-input::placeholder {
    color: var(--text-dim);
    opacity: 0.5;
  }
  .dl-proxy-save {
    padding: 5px 10px;
    background: var(--accent);
    border: none;
    border-radius: var(--radius-sm);
    color: #fff;
    font-size: 10px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    transition: opacity var(--transition);
  }
  .dl-proxy-save:hover {
    opacity: 0.85;
  }
  .dl-start-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 28px;
    border: none;
    border-radius: var(--radius-sm);
    background: var(--accent);
    color: #fff;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all var(--transition);
    width: 100%;
  }
  .dl-start-btn:hover:not(:disabled) {
    box-shadow: 0 4px 20px var(--accent-glow);
    transform: translateY(-1px);
  }
  .dl-start-btn:disabled {
    opacity: 0.4;
    pointer-events: none;
  }
  .dl-start-btn.downloading {
    background: var(--surface-2);
    border: 1.5px solid var(--border);
    pointer-events: none;
  }
  .dl-start-btn.done {
    background: var(--success);
    box-shadow: 0 2px 12px rgba(52, 199, 123, 0.3);
  }
  /* Progress */
  .dl-progress {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 14px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    animation: fadeIn 0.2s ease-out;
  }
  .dl-progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .dl-progress-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
  }
  .dl-progress-pct {
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
  }
  .dl-progress-bar-wrap {
    height: 6px;
    background: var(--surface-2);
    border-radius: 3px;
    overflow: hidden;
  }
  .dl-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), #a78bfa);
    border-radius: 3px;
    transition: width 0.3s ease;
  }
  .dl-progress-meta {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    color: var(--text-dim);
  }
  /* Actions row */
  .dl-actions-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .dl-clear-btn {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    padding: 8px 18px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface-2);
    color: var(--text-dim);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
    font-family: inherit;
    width: 100%;
    justify-content: center;
  }
  .dl-clear-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(124, 92, 252, 0.06);
  }
  .dl-clear-btn svg {
    opacity: 0.7;
    transition: opacity var(--transition);
  }
  .dl-clear-btn:hover svg {
    opacity: 1;
  }
</style>
